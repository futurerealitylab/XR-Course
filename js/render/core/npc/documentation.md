# Documentation for npc.js

Sample usages can be found in scenes/ikHumanoid.js & scenes/spider.js.

## Class `NPCSystem`

### `new NPCSystem(model, dimX, dimY, dimZ, res)`

Optional:  
`dimX`, `dimY`, and `dimZ` define the dimension of the terrain system. Default is 16x16x16.  
`res` defines the resolution of the terrain system, i.e. 1 terrain grid = 1/res (global unit). Default is 1.

This will create a NPC System, which is the prerequisite for the NPCs and terrain system.

### `.initRender(node, meshTerrainName)`

Optional:  
`meshTerrainName`. To render the terrain, a combined mesh will be generated, this name is for the mesh. Default is "_NPCTerrain".

Please call this function before calling any other function related to the rendering.

### `.getRootNode()`

returns the root node of the NPC System, which can be used to move, scale, etc. the whole system.

### `.getNPCsRootNode()`

returns the root node of all the NPCs. When rendering custom meshes for NPCs, it is recommended to add those meshes to this node.

### `.getTerrain()`

returns the NPCTerrain object.

### `.adaptTerrainToMeshes(nodeList, genMesh = true)`

makes the terrain adapt to the meshes of the nodes in the nodeList. Then, reset all NPC's Y position to fit the terrain.  
This function may heavily impact the CPU performance.  
When genMesh = true (default), the terrain mesh will be regenerated.  
When genMesh = false, the terrain mesh will not be regenerated.

### `.addNPC(type, id, render, position)`

adds a new NPC to the system.  
Available types are: "humanoid", "triped", "quadruped", "pentaped", "hexapod", "heptapod", "octopod".

Optional:  
`id`. The id of the NPC. If not specified, an id will be autogenerated.  
`render`. A boolean value to control if npc.initRender() is called. When `false`, the NPC is not added to the rendering. Default is `true`.  
`position`. A vec3 that defines the initial position of the newly added NPC. (y value is not used since the npc will be reset to fit the terrain in Y axis)

### `.getNPC(id)`

returns the NPC object by id.

### `.setNPCMoveVec(id, moveVec)`

sets the vector of the movement of the NPC with certain id. It is used to control the NPC.

### `.update()`

Call this in the model.animate(()=>{}) loop to update the NPC as well as their rendering if applicable.

## Class `NPCTerrain`

### `.clear()`

resets the terrain to a plain at y=0 (local).

### `.randomize()`

generate the terrain with noise-based height. Data only: it will NOT update the mesh. To update the mesh, call `.generateMesh()` after it.

### `.generateMesh(meshName)`

updates the mesh of terrain.  
Optional:  
`meshName`. Default is "_NPCTerrain".

## Class `Humanoid`

### `.getBodyNodes()`

returns the `ikbody.graph.nodes`.

## Class `RobotMultiLegs`

The term **local** means local to the root node for NPCs, which can be acquired from NPCSystem's `.getNPCsRootNode()`.

### `.getPos()`

returns the **local** position of the robot. It is always on the ground.

### Functions for rendering custom meshes

`.getBodyPos()`
- returns the **local** position of the robot's body.

`.getLegPartsPos(n)`
- returns the **local** positions of the root, foot, and knee of the n-th leg.
- Format: `{ root: number[3], foot: number[3], knee: number[3] }`